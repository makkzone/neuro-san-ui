# Set python image as base image

# Here we purposely hard code the python version because
# this image must be built before we take a new python version
# for the entire neuro ai service stack. This image gets built and 
# pushed once and is consumed as the starting FROM for the service
# containers.
FROM python:3.12-slim

# Set the shell and options per hadolint recommendations
SHELL ["/bin/bash", "-o", "pipefail", "-c"]

# Define the build argument for the Git version, no default provided by design
ARG FGA_VERSION

# Set the Git version as an environment variable
ENV FGA_VERSION=${FGA_VERSION}

# Ubuntu basics and everything needed to run fga scripts
RUN apt-get update -y \
    && apt-get install --no-install-recommends --yes \
            wget=1.21.3-1+b2 \
            jq=1.6-2.1 \
    && rm -rf /var/lib/apt/lists/*

# Steps for installing OpenFGA command line app (fga)
ENV FGA_INSTALL_FILE fga_${FGA_VERSION}_linux_386.deb
RUN wget --progress=dot:giga -O /tmp/${FGA_INSTALL_FILE} \
          https://github.com/openfga/cli/releases/download/v${FGA_VERSION}/${FGA_INSTALL_FILE} \
    && dpkg --add-architecture i386 \
    && dpkg -i /tmp/${FGA_INSTALL_FILE} \
    && fga --version
